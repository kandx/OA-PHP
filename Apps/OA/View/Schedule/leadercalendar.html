<extend name="Base/base" />

<block name="page_styles">
	<link rel="stylesheet" href="__CSS__/fullcalendar.css" />
	<link rel="stylesheet" href="__CSS__/bootstrap-datetimepicker.min.css" />
	<link rel="stylesheet" href="__CSS__/jquery.gritter.css" />
	
</block>

<block name="content">
	<div class="row">
		<div class="col-sm-10">
			<div class="space"></div>

			<!-- #section:plugins/data-time.calendar -->
			<div id="calendar"></div>
			
			<!-- /section:plugins/data-time.calendar -->
		</div>
		<div class="col-sm-2">
			<div class="space"></div>
			
			<include file="image-description" />
		</div>

	</div>
</block>

<block name="page_js">
	<script src="__JS__/date-time/moment.min.js"></script>
	<script src="__JS__/jquery-ui.custom.min.js"></script>
	<script src="__JS__/jquery.ui.touch-punch.min.js"></script>
	<script src="__JS__/fullcalendar.min.js"></script>
	<script src="__JS__/zh-cn.js"></script>
	<script src="__JS__/jquery.gritter.min.js"></script>
</block>

<block name="inline_js">
	<script type="text/javascript">
		jQuery(function($){
			var calendar = $('#calendar').fullCalendar({
				header: {
					left: 'prev,next today',
					center: 'title',
					right: 'month,agendaWeek,agendaDay'
				},
                timeFormat: 'H:mm',
                buttonText: {
                    prev: '<',
                    next: '>',
                }, 
				minTime: "06:00:00",
				maxTime: "21:00:00",
				slotDuration: "00:15:00",
				weekNumbers: true,
				events: "{:U('Schedule/getEvents')}",
				eventClick: function(calEvent, jsEvent, view){
					$.get("{:U('Schedule/getEventInfo')}", {event_id:calEvent.id}, function(data, textStatus){
						var content = "<p>"+"开始时间："+formatTime(calEvent.start)+"<br>"+"结束时间："+formatTime(calEvent.end)+"<br>"+"说&nbsp;&nbsp;"+"明："+data['description']+"</p>";
						$.gritter.add({
							title: calEvent.title,
							text: content,
							image: "__STATIC__/avatars/avatar1.png",//data['image'],
							sticky: false,
							time: '',
							class_name: ''
						});
					}, 'json');
				}
				
			});
			
		});

		$('#leaderIds').on('click', function(){
			var ids = [];
			$("input[type='checkbox']:checked").each(function(){
				ids.push($(this).val());
			});
			$.post("{:U('Schedule/getEvents')}", ids, function(data){
				$('#calendar').fullCalendar('updateEvent', data);
			}, 'json');
		});
		
		setSidebarActive('calendar_root', 'leader_calendar');

		function formatTime(time){
			if(!time)
				return '';
			if(time.hasTime())
				return time.format('YYYY-M-D H:mm');
			else
				return time.format('YYYY-M-D');
		}
		
	</script>
</block>