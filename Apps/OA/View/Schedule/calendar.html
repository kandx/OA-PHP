<extend name="Base/base" />

<block name="page_styles">
	<link rel="stylesheet" href="__CSS__/fullcalendar.css" />
	<link rel="stylesheet" href="__CSS__/bootstrap-datetimepicker.min.css" />
	
</block>

<block name="content">
	<div class="row">
		<div class="col-sm-10">
			<div class="space"></div>

			<!-- #section:plugins/data-time.calendar -->
			<div id="calendar"></div>
			
			<!-- /section:plugins/data-time.calendar -->


			<div id="event-form" class="modal" tabindex="-1">
				<div class="modal-dialog">
					<div class="modal-content">
		
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal">&times;</button>
							<h4 class="blue bigger">请填写日程信息</h4>
						</div>

						<div class="modal-body">
							<div class="row">				
								<div class="col-xs-12 col-sm-12">
									<form class="form-horizontal" role="form"  method="post" action="{:U('Schedule/add')}">

										<div class="form-group">
											<label class="col-sm-3 control-label no-padding-right" for="article_no"> 日程内容: </label>
											<div class="col-sm-9">
												<input type="text" name="title" id="title" placeholder="日程内容" class="col-xs-10 col-sm-8" />
											</div>
										</div>

										<div class="form-group">							
											<label class="col-sm-3 control-label no-padding-right" for="begin_time"> 开始时间: </label>
											<div class="col-sm-9">
												<input type="text" id="begin_time" name="begin_time" class="datetime-picker col-xs-10 col-sm-8" data-date-format="yyyy-mm-dd hh:ii">
											</div>
										</div>
										
										<div class="form-group">							
											<label class="col-sm-3 control-label no-padding-right" for="end_time"> 结束时间: </label>
											<div class="col-sm-9">
												<input type="text" id="end_time" name="end_time" class="datetime-picker col-xs-10 col-sm-8" value="">
											</div>
										</div>

								</div>
							</div>
						</div>

						<div class="modal-footer">
							<button class="btn btn-sm" data-dismiss="modal" >
								<i class="ace-icon fa fa-times"></i>
								取消
							</button>

							<button class="btn btn-sm btn-primary" type="submit">
								<i class="ace-icon fa fa-check"></i>
								保存
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</block>

<block name="page_js">
	<script src="__JS__/date-time/moment.min.js"></script>
	<script src="__JS__/jquery-ui.custom.min.js"></script>
	<script src="__JS__/jquery.ui.touch-punch.min.js"></script>
	<script src="__JS__/date-time/bootstrap-datetimepicker.min.js"></script>
	<script src="__JS__/date-time/locales/bootstrap-datetimepicker.zh-CN.js"></script>
	
	<script src="__JS__/fullcalendar.min.js"></script>
	<script src="__JS__/zh-cn.js"></script>
	<script src="__JS__/bootbox.min.js"></script>



</block>

<block name="inline_js">
	<script type="text/javascript">
		jQuery(function($){
			var calendar = $('#calendar').fullCalendar({
				header: {
					left: 'prev,next today',
					center: 'title',
					right: 'month,agendaWeek,agendaDay'
				},
                timeFormat: 'H:mm',
                buttonText: {
                    prev: '<',
                    next: '>',
                }, 
				weekNumbers: true,
				events: "{:U('Schedule/getEvents', array('id'=>session('uid')))}",
				selectable: true,
				selectHelper: true,
				select: function(start, end, jsEvent, view) {
					// var sTime, eTime;
					// if(start.hasTime())
					// 	sTime = start.format('YYYY-M-D H:mm');
					// else
					// 	sTime = start.format('YYYY-M-D');
					// if(end.hasTime())
					// 	eTime = end.format('YYYY-M-D H:mm');
					// else
					// 	eTime = end.format('YYYY-M-D');

					// $("#begin_time").attr('value', sTime);
					// $('#end_time').attr('value', eTime);
					// //$('#is_allday').attr('value', allDay);
					// $('.modal').modal('show');
					bootbox.setLocale("zh_CN");
					bootbox.prompt("新日程内容:", function(title) {
						var eventData;
						if(title!==null){
							eventData = {
								title: title,
								begin_time: start.format('YYYY-M-D H:mm'),
								end_time: end.format('YYYY-M-D H:mm'),
								user_id: {:session('uid')},
								color: '#DC143C',
								is_allday: false
							};
							$.post("{:U('Schedule/add')}", eventData,function(msg){
								if(msg==1){
									$('#calendar').fullCalendar('refetchEvents');
								}
								else{
									bootbox.alert(msg);
								}
							});
						}	
					});
				},
					
					/*
					var eventData;
					if (title) {
						eventData = {
							title: title,
							start: start,
							end: end
						};
						$('#calendar').fullCalendar('renderEvent', eventData, true); // stick? = true
					}
					$('#calendar').fullCalendar('unselect');*/
				
				editable: true,
			});
			
			$('.datetime-picker').datetimepicker({
				format:'yyyy-mm-dd hh:ii',
				autoclose:true,
				todayBtn:true,
				language:'zh-CN',
			});
		});
	</script>
</block>